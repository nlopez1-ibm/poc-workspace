// Sample Jenkinsfile using pGH, ssh and a zDT Agent (Nlopez)
// tap=XXc5748804da508e6cb3ad7f077a82478b4e162151XX=tap
// for help: https://www.jenkins.io/doc/book/pipeline/jenkinsfile/
 
// change these values to match your configuration
def dbbbuild ='/u/nlopez/tmp/dbb-zappbuild/build.groovy'
def repo = 'git@github.com:nlopez1-ibm/poc-workspace.git'
//def app_workspace = 'poc-workspace'
def app_name = 'poc-app'
def myAgent  = 'myZOS-Agent'


// no changes required to this section 
pipeline {
    agent  { label myAgent } 
    options { skipDefaultCheckout(true) }
    stages {
        stage('Clone') {
            steps {
                println '** Cloning on USS ...'     
                sh 'rm -rf *'
                sh 'git clone ' repo 
                sh 'cd poc-workspace ; git log --graph --oneline --decorate -n 3'                      
                
            }          
        }  

        stage('Build') {
            steps {
                println  '** Building one pgm with DBB ...'                  
                sh 'groovyz ' + dbbbuild + ' -w ' + env.wkDir + ' -a ' + app_name + ' -o dbb-logs -h ' + env.USER + ' poc-app/cobol/datbatch'
            }
        }                        
    }    
}
